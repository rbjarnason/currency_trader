:javascript
    AmCharts.ready(function () {
        createStockChart();
    });

    var chartData = [#{@trading_strategy.get_chart_data}]

    var chart;

    function createStockChart() {
        chart = new AmCharts.AmStockChart();
        chart.pathToImages = "/assets/amimages/";
        chart.panEventsEnabled = true;
        // DATASETS //////////////////////////////////////////
        var dataSet = new AmCharts.DataSet();
        dataSet.color = "#b0de09";
        dataSet.fieldMappings = [{
            fromField: "value",
            toField: "value"
        }, {
            fromField: "volume",
            toField: "volume"
        }];
        dataSet.dataProvider = chartData;
        dataSet.categoryField = "date";

        // set data sets to the chart
        chart.dataSets = [dataSet];


        //var categoryAxesSettings = new AmCharts.CategoryAxesSettings();
        //categoryAxesSettings.minPeriod = "hh";
        //chart.categoryAxesSettings = categoryAxesSettings;
        // PANELS ///////////////////////////////////////////
        // first stock panel
        var stockPanel1 = new AmCharts.StockPanel();
        stockPanel1.showCategoryAxis = false;
        stockPanel1.title = "Value";
        stockPanel1.percentHeight = 70;
        stockPanel1.panEventsEnabled = true;

        // graph of first stock panel
        var graph1 = new AmCharts.StockGraph();
        graph1.valueField = "value";
        stockPanel1.addStockGraph(graph1);

        // create stock legend
        var stockLegend1 = new AmCharts.StockLegend();
        stockLegend1.valueTextRegular = " ";
        stockLegend1.markerType = "none";
        stockPanel1.stockLegend = stockLegend1;
        // set panels to the chart
        chart.panels = [stockPanel1];


        // OTHER SETTINGS ////////////////////////////////////
        var scrollbarSettings = new AmCharts.ChartScrollbarSettings();
        scrollbarSettings.graph = graph1;
        scrollbarSettings.updateOnReleaseOnly = true;
        chart.chartScrollbarSettings = scrollbarSettings;

        var cursorSettings = new AmCharts.ChartCursorSettings();
        cursorSettings.valueBalloonsEnabled = true;
        chart.chartCursorSettings = cursorSettings;


        // PERIOD SELECTOR ///////////////////////////////////
        var periodSelector = new AmCharts.PeriodSelector();
        periodSelector.periods = [
        {
            period: "DD",
            count: 10,
            label: "10 days"
        }, {
            period: "MM",
            selected: true,
            count: 1,
            label: "1 month"
        }, {
            period: "YYYY",
            count: 1,
            label: "1 year"
        }, {
            period: "YTD",
            label: "YTD"
        }, {
            period: "MAX",
            label: "MAX"
        },
        {
            period: "hh",
            count: 1,
            label: "1 hour"
        }, {
            period: "hh",
            count: 1,
            label: "2 hours"
        }, {
            period: "hh",
            count: 2,
            label: "2 hours"
        }, {
            period: "hh",
            count: 5,
            label: "5 hour"
        }, {
            period: "hh",
            count: 12,
            label: "12 hours"
        }, {
            period: "MAX",
            label: "MAX"
        }];
        chart.periodSelector = periodSelector;


        var panelsSettings = new AmCharts.PanelsSettings();
        panelsSettings.usePrefixes = true;
        panelsSettings.panEventsEnabled = true;
        chart.panelsSettings = panelsSettings;


        // EVENTS
        var e0 = {
            date: new Date(2010, 8, 19),
            type: "sign",
            backgroundColor: "#85CDE6",
            graph: graph1,
            text: "S",
            description: "This is description of an event"
        };
        var e1 = {
            date: new Date(2010, 10, 19),
            type: "flag",
            backgroundColor: "#FFFFFF",
            backgroundAlpha: 0.5,
            graph: graph1,
            text: "F",
            description: "Some longer\ntext can also\n be added"
        };
        var e2 = {
            date: new Date(2010, 11, 10),
            showOnAxis: true,
            backgroundColor: "#85CDE6",
            type: "pin",
            text: "X",
            graph: graph1,
            description: "This is description of an event"
        };
        var e3 = {
            date: new Date(2010, 11, 26),
            showOnAxis: true,
            backgroundColor: "#85CDE6",
            type: "pin",
            text: "Z",
            graph: graph1,
            description: "This is description of an event"
        };
        var e4 = {
            date: new Date(2011, 0, 3),
            type: "sign",
            backgroundColor: "#85CDE6",
            graph: graph1,
            text: "U",
            description: "This is description of an event"
        };
        var e5 = {
            date: new Date(2011, 1, 6),
            type: "sign",
            graph: graph1,
            text: "D",
            description: "This is description of an event"
        };
        var e6 = {
            date: new Date(2011, 3, 5),
            type: "sign",
            graph: graph1,
            text: "L",
            description: "This is description of an event"
        };
        var e7 = {
            date: new Date(2011, 3, 5),
            type: "sign",
            graph: graph1,
            text: "R",
            description: "This is description of an event"
        };
        var e8 = {
            date: new Date(2011, 5, 15),
            type: "arrowUp",
            backgroundColor: "#00CC00",
            graph: graph1,
            text: "A",
            description: "This is description of an event"
        };
        var e9 = {
            date: new Date(2011, 6, 25),
            type: "arrowDown",
            backgroundColor: "#CC0000",
            graph: graph1,
            text: "B",
            description: "This is description of an event"
        };
        var e10 = {
            date: new Date(2011, 8, 1),
            type: "text",
            graph: graph1,
            text: "Longer text can\nalso be displayed",
            description: "This is description of an event"
        };

        dataSet.stockEvents = [e0, e1, e2, e3, e4, e5, e6, e7, e8, e9, e10];

        chart.write('chartdiv_#{@trading_strategy.id}');
    }

%div{:id=>"chartdiv_#{@trading_strategy.id}", :style => "width:100%; height:500px;margin-bottom:10px;"}